(()=>{"use strict";const a=2550,t=1600,e=640,n=367;onmessage=async o=>{const{url:r,RADAR_HOST:d,OVERRIDES:s,radarSourceXY:h}=o.data,g=s.RADAR_HOST?r.replace(d,s.RADAR_HOST):r,i=fetch(g),c={width:240,height:163,x:Math.round(h.x/2),y:Math.round(h.y/2)},w=new OffscreenCanvas(a,t),m=w.getContext("2d");m.imageSmoothingEnabled=!1;const l=await i;if(!l.ok)throw new Error(`Unable to fetch radar error ${l.status} ${l.statusText} from ${l.url}`);const f=await l.blob(),u=await createImageBitmap(f);m.clearRect(0,0,a,t),m.drawImage(u,0,0,a,t);const R=new OffscreenCanvas(c.width,c.height),I=R.getContext("2d");I.imageSmoothingEnabled=!1,I.drawImage(w,c.x,c.y,R.width,R.height,0,0,R.width,R.height),(a=>{const t=a.getImageData(0,0,a.canvas.width,a.canvas.height);for(let a=0;a<t.data.length;a+=4){let e=t.data[a],n=t.data[a+1],o=t.data[a+2],r=t.data[a+3];0===e&&0===n&&0===o||0===e&&236===n&&236===o||1===e&&160===n&&246===o||0===e&&0===n&&246===o?(e=0,n=0,o=0,r=0):0===e&&255===n&&0===o?(e=49,n=210,o=22,r=255):0===e&&200===n&&0===o?(e=0,n=142,o=0,r=255):0===e&&144===n&&0===o?(e=20,n=90,o=15,r=255):255===e&&255===n&&0===o?(e=10,n=40,o=10,r=255):231===e&&192===n&&0===o?(e=196,n=179,o=70,r=255):255===e&&144===n&&0===o?(e=190,n=72,o=19,r=255):214===e&&0===n&&0===o||255===e&&0===n&&0===o?(e=171,n=14,o=14,r=255):(192===e&&0===n&&0===o||255===e&&0===n&&255===o)&&(e=115,n=31,o=4,r=255),t.data[a]=e,t.data[a+1]=n,t.data[a+2]=o,t.data[a+3]=r}a.putImageData(t,0,0)})(I);const S=new OffscreenCanvas(e,n),x=S.getContext("2d",{willReadFrequently:!0});x.imageSmoothingEnabled=!1,x.drawImage(R,0,0,c.width,c.height,0,0,e,n);const O=S.transferToImageBitmap();postMessage(O,[O])}})();